<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TemplateApplicationResource.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">quarkus-application</a> &gt; <a href="index.source.html" class="el_package">at.htl.beeyond.resource</a> &gt; <span class="el_source">TemplateApplicationResource.kt</span></div><h1>TemplateApplicationResource.kt</h1><pre class="source lang-java linenums">package at.htl.beeyond.resource

import at.htl.beeyond.dto.TemplateApplicationDto
import at.htl.beeyond.entity.Template
import at.htl.beeyond.entity.TemplateApplication
import at.htl.beeyond.entity.User
import io.quarkus.hibernate.orm.panache.PanacheEntityBase
import javax.annotation.security.RolesAllowed
import javax.transaction.Transactional
import javax.validation.Valid
import javax.ws.rs.Consumes
import javax.ws.rs.POST
import javax.ws.rs.Path
import javax.ws.rs.Produces
import javax.ws.rs.core.Context
import javax.ws.rs.core.MediaType
import javax.ws.rs.core.Response
import javax.ws.rs.core.SecurityContext

@Path(&quot;/application/template&quot;)
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
<span class="fc" id="L23">class TemplateApplicationResource {</span>

    @POST
    @RolesAllowed(&quot;student&quot;, &quot;teacher&quot;)
    @Transactional
    fun createTemplateApplication(
            @Context context: SecurityContext,
            @Valid templateApplicationDto: TemplateApplicationDto?
    ): Response {
<span class="fc" id="L32">        val template = Template.findById&lt;Template&gt;(templateApplicationDto!!.templateId)</span>
<span class="pc bpc" id="L33" title="1 of 2 branches missed.">        if (template.deleted) {</span>
<span class="nc" id="L34">            return Response.status(Response.Status.NOT_FOUND).build()</span>
        }

<span class="fc" id="L37">        val owner = User.find&lt;PanacheEntityBase&gt;(&quot;name&quot;, context.userPrincipal.name).firstResult&lt;User&gt;()</span>
<span class="fc" id="L38">        val templateApplication = TemplateApplication(templateApplicationDto, owner)</span>
<span class="fc" id="L39">        templateApplication.persist()</span>
<span class="fc" id="L40">        return Response.noContent().build()</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>